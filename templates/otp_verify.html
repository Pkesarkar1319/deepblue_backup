<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <title>Verification</title>
    <script src=
    "https://smtpjs.com/v3/smtp.js">
  </script>
    <script>
        var otp = sendEmail(0)

        var seconds_left = 20;
        var interval = setInterval(function() {
       document.getElementById('timer').innerHTML =--seconds_left;
   
       if (seconds_left <= 0)
       {
          document.getElementById('resendotp').disabled=false;
          clearInterval(interval);
       }
      
   }, 1000);
       
       
         
         
        function sendEmail(flag) {
         this.x=OtpGenerate()
         console.log(x) 
           
           if(flag)
   
           { var seconds=document.getElementById('timer').innerHTML; 
             var verify=document.getElementById("otpinput").value;
            if(seconds>0){
              if(verify == x)
            {
             //alert("success")
            
             var m=document.getElementById('msg')
             m.className='alert alert-info w-50 mx-5';
             m.innerHTML='<strong>OTP Verified!</strong>Your Account is succesfully Registerd'
             window.open("{% url 'index' %}")
             window.close
            }
            else{
                var m=document.getElementById('msg')
                m.className='alert alert-danger w-50 mx-5';
                m.innerHTML='Entered <strong>OTP</strong> is Invalid !!! Try Again'
                window.open("{% url 'reload' %}",'_self')
            }
            // console.log(x)
             }
             else{
              // alert("resend otp")
              var m=document.getElementById('msg')
              m.className='alert alert-warning w-50 mx-5';
                m.innerHTML='Verify <strong>OTP</strong> within time limits! Click on Resend OTP to verify Again'
             }
          }
         else{
          console.log("email") 
          console.log("{{email}}") 
           Email.send({
           Host: "smtp.gmail.com",
           Username: "2019prathmesh.kesarkar@ves.ac.in",
           Password: "Pkesarkar@1319",
           To: '{{email}}',
           From: "2019prathmesh.kesarkar@ves.ac.in",
           Subject: "Team Resume Parser",
           Body: "Your OTP pin is"+x,
         })}
         
          
       }
      
     
           function sndotp()
           {
             sendEmail(0)
             document.getElementById('resendotp').disabled=true;
             var seconds_left = 20;
        var interval = setInterval(function() {
       document.getElementById('timer').innerHTML =--seconds_left;
   
       if (seconds_left <= 0)
       {
         document.getElementById('resendotp').disabled=false;
          clearInterval(interval);
       }
      
      }, 1000);
         }
   
        function verify()
           { 
             var e = new sendEmail(1)
             
           }
   
          function OtpGenerate(){
               var alpha = new Array('1','2','3','4','5','6','7','8','9','0');
               var i;
               for (i=0;i<3;i++){
                   var a = alpha[Math.floor(Math.random() * alpha.length)];
                   var b = alpha[Math.floor(Math.random() * alpha.length)];
                   var c = alpha[Math.floor(Math.random() * alpha.length)];
                   var d = alpha[Math.floor(Math.random() * alpha.length)];
                  
               }
               var code = a  + b +  c + d ;
              return code
              // document.getElementById("mainCaptcha").value = code
              // var colors = ["#B40404", "#beb1dd", "#b200ff", "#faff00", "#0000FF", "#FE2E9A", "#FF0080", "#2EFE2E", ];
              // var rand = Math.floor(Math.random() * colors.length);
              // $('#mainCaptcha').css("background-color", colors[rand]);
              
           }
           
           
    </script>
</head>
<body>
<div class="alert " role="alert" id="msg"></div>
<div class="container w-50 p-5 my-5 shadow p-3 mb-5  rounded">
    <center><h3>Verify Your Email To Complete Account Registration </h3></center>
    <div class="alert alert-info">
      <center>You will be redirected to Login if otp is <strong>Verified!</strong></center>
    </div><br>
    

    Enter OTP sent on your email <div id="timer"class="timer"style="display:inline;color:green;font-weight:bold"></div>
    <input type="text" class="form-control m-1 " id="otpinput"maxlength="4"></input>
    <form id="succ" >
    <button type="submit" class="btn btn-primary m-2" onclick="verify()">Verify</button></form>
    <button type="submit" id="resendotp"class="btn btn-primary m-2"  onclick="sndotp()"disabled>Resend OTP</button>
   
</div>



</body>
</html>